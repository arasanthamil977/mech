<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Perfect Piano â€“ Professional</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== RESET ===== */
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

/* ===== BODY ===== */
body{
  background:linear-gradient(#0c0c18,#05050a);
  font-family:system-ui,Segoe UI,Arial;
  color:#fff;
  overflow-x:auto;
}

/* ===== HEADER ===== */
header{
  text-align:center;
  padding:14px;
  font-size:18px;
  letter-spacing:1px;
}

/* ===== PIANO WRAP ===== */
.piano-wrap{
  padding:20px 10px 30px;
  overflow-x:auto;
}

/* ===== PIANO ===== */
.piano{
  position:relative;
  display:flex;
  height:260px;
  min-width:max-content;
}

/* ===== WHITE KEYS ===== */
.white{
  width:52px;
  height:260px;
  background:linear-gradient(#fff,#eaeaea);
  border:1px solid #bbb;
  border-radius:0 0 10px 10px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom:8px;
  font-size:11px;
  font-weight:600;
  color:#000;
  user-select:none;
}

.white.active{
  background:linear-gradient(#ddd,#fff);
  box-shadow:inset 0 6px 16px rgba(0,0,0,.35);
}

/* ===== BLACK KEYS ===== */
.black{
  width:32px;
  height:160px;
  background:linear-gradient(#111,#000);
  position:absolute;
  top:0;
  z-index:5;
  border-radius:0 0 7px 7px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom:6px;
  font-size:10px;
  color:#fff;
  user-select:none;
}

.black.active{
  background:#222;
}

/* ===== FOOTER ===== */
footer{
  text-align:center;
  font-size:12px;
  opacity:.75;
  padding-bottom:12px;
}
</style>
</head>

<body>

<header>ðŸŽ¹ Perfect Piano â€“ 88 Keys (A0 to C8)</header>

<div class="piano-wrap">
  <div class="piano" id="piano"></div>
</div>

<footer>Touch â€¢ Mouse â€¢ Keyboard â€¢ Fixed Professional Sound</footer>

<script>
/* =========================================================
   PROFESSIONAL PIANO SOUND ENGINE (FIXED)
   ========================================================= */

const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

/* Master volume */
const masterGain = audioCtx.createGain();
masterGain.gain.value = 0.85;
masterGain.connect(audioCtx.destination);

/* Notes */
const noteNames = ["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];
const blackSet = new Set(["A#","C#","D#","F#","G#"]);

/* Piano container */
const piano = document.getElementById("piano");
let whiteIndex = 0;

/* ===== CREATE 88 KEYS ===== */
for(let midi=21; midi<=108; midi++){
  const freq = 440 * Math.pow(2,(midi-69)/12);
  const note = noteNames[midi % 12];
  const octave = Math.floor((midi - 12) / 12);
  const label = note + octave;

  if(!note.includes("#")){
    const white = document.createElement("div");
    white.className = "white";
    white.textContent = label;
    white.dataset.freq = freq;
    piano.appendChild(white);
    whiteIndex++;

    /* Check for black key after this white key */
    const nextNote = noteNames[(midi + 1) % 12];
    if(blackSet.has(nextNote)){
      const black = document.createElement("div");
      black.className = "black";
      black.textContent = nextNote + octave;
      black.dataset.freq = 440 * Math.pow(2,((midi + 1)-69)/12);
      black.style.left = (whiteIndex * 52 - 16) + "px";
      piano.appendChild(black);
    }
  }
}

/* ===== PLAY NOTE (REALISTIC PIANO) ===== */
function playNote(freq){
  if(audioCtx.state === "suspended") audioCtx.resume();

  const now = audioCtx.currentTime;

  /* Harmonic oscillators */
  const osc1 = audioCtx.createOscillator();
  const osc2 = audioCtx.createOscillator();
  const osc3 = audioCtx.createOscillator();

  osc1.type = "triangle";
  osc2.type = "sine";
  osc3.type = "sine";

  osc1.frequency.value = freq;
  osc2.frequency.value = freq * 2;
  osc3.frequency.value = freq * 3;

  /* Envelope */
  const gain = audioCtx.createGain();
  gain.gain.setValueAtTime(0.0001, now);
  gain.gain.linearRampToValueAtTime(0.5, now + 0.03);
  gain.gain.exponentialRampToValueAtTime(0.28, now + 0.25);
  gain.gain.exponentialRampToValueAtTime(0.0001, now + 1.9);

  /* Low-pass filter for warmth */
  const filter = audioCtx.createBiquadFilter();
  filter.type = "lowpass";
  filter.frequency.value = 4200;

  osc1.connect(filter);
  osc2.connect(filter);
  osc3.connect(filter);
  filter.connect(gain);
  gain.connect(masterGain);

  osc1.start(now);
  osc2.start(now);
  osc3.start(now);

  osc1.stop(now + 2);
  osc2.stop(now + 2);
  osc3.stop(now + 2);
}

/* ===== INTERACTION ===== */
document.querySelectorAll(".white,.black").forEach(key=>{
  const freq = +key.dataset.freq;

  const down = ()=>{
    playNote(freq);
    key.classList.add("active");
  };
  const up = ()=>key.classList.remove("active");

  key.addEventListener("mousedown",down);
  key.addEventListener("touchstart",down,{passive:true});
  key.addEventListener("mouseup",up);
  key.addEventListener("mouseleave",up);
  key.addEventListener("touchend",up);
});

/* ===== KEYBOARD SUPPORT (CENTER OCTAVE) ===== */
const keyboardMap = {
  a:60, w:61, s:62, e:63, d:64,
  f:65, t:66, g:67, y:68, h:69,
  u:70, j:71, k:72
};

document.addEventListener("keydown",e=>{
  if(keyboardMap[e.key]){
    const freq = 440 * Math.pow(2,(keyboardMap[e.key]-69)/12);
    playNote(freq);
  }
});
</script>

</body>
</html>
